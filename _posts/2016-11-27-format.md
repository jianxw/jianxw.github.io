---
layout: post
title: 格式化数据
tags:
- sed
- python
- shell
categories: python
---
　　最近进行线上问题的处理需要对数据进行格式化，所以准备研究一下怎么样快速和有效的对数据进行处理，准备把研究总结的方法分享给大家，同时介绍python的一些基本使用以及在运维过程中的一些有用的工具包。
　　比如把多行数据格式化为mysql的in查询的条件：
　　111111
　　222222
　　333333
格式化为：
　　('111111','222222','333333')
本文总共介绍3中方式来实现：
- 通过notepad++来实现；
- 通过linux的cat和sed命令来实现；
- 通过python来实现。


<!-- more -->
####通过notepad++实现

![](/img/20161129/notepad.png)
<br/>
然后把前后再替换一下就能够格式化为需要的格式，如果感兴趣的朋友可以去研究一下notepad++的正则表达式替换，但是如果针对数据量比较大，同时生产环境的数据不方便备份下来的话这个方式操作比较复杂。

####通过cat和sed来实现

```bash
[root@dev tmp]# cat test_sed.txt | xargs | sed -e "s/ /','/g" | sed -e "s/^/('/g" | sed -e "s/$/')/g"
('123456','234567','345678')
```
通过这种方式能够很好的完成要求，但是如果针对比较复杂的替换，需要比较熟悉sed的操作，才能够很好很快的完成。
sed的学习可以参照文档：http://coolshell.cn/articles/9104.html

####通过python脚本来实现
python脚本比前两种方式要复杂，但是如果针对比较复杂的替换，python就能够很好的完成，服务器也都自带python，同时python有很多比较好用的工具类，能够帮助运维更叫高效的完成有关工作。

具体的python代码为：

```python
# -*- coding: utf-8 -*-
import sys
if sys.argv.__len__() <= 1:
    print ("请输入文件名字")
else:
    try:
        with open(sys.argv[1]) as f:
            content = f.readlines()
            print ("('" + "','".join([line.rstrip('\n') for line in content]) + "')")
    except:
        print ("处理文件异常")
```

运行的结果为：

```bash
[root@dev tmp]# python test.py test_sed.txt
('123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','123456','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678','234567','345678')
```
python的学习教程可以参照：http://www.runoob.com/python3/python3-tutorial.html
####总结
　　文章主要举了一个文字格式化的例子，总结了几种处理方法，针对简单的文本处理前两种能够很好的完成，但是如果针对复杂的数据处理，python脚本是比较好的选择，加上linux服务器都默认装了python应用，运行python脚本也较方便，同时python一些工具包比如fabric（SSH连接）、psutil（获取系统信息）、supervisor（进程监控）、ansible（自动化运维）都是运维中特别好用的工具类。